<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<meta name="robots" content="nofollow" />
	<link rel="stylesheet" media="screen" href="css/search.css" type="text/css" />
	
	<title>Funnelback Search</title>

	<style type="text/css">
		li.even h3 {lb}
			border: solid 2px #dddddd;
	{rb}
	</style>

</head>

<body>

    <% if (! response) { %>
	    <!-- NO QUERY SPECIFIED -->
    	<div id="fb-initial">
    		<a href="http://funnelback.com/"><img src="img/funnelback.png" alt="Funnelback logo"></a>
    	</div>
    <% } %>
	
	<!-- SEARCH LOGO -->
	<div><a id="fb-logo" <% (response) ? '' : 'class="fb-initial"' %> href="http://funnelback.com/"><img	src="img/funnelback-small.png" alt="Funnelback logo" width="170" height="36"></a></div>
	
	<!-- QUERY FORM -->
	
	<div id="fb-queryform" <% (response) ? '' : 'class="fb-initial"' %>>
		<form method="GET">
			<div>
				<label for="query" style="text-indent: -9999em;">Search</label>
				<input name="query" id="query" type="text" value="<%= question.query %>" accesskey="q" />
				<input type="submit" value="Search" />
			
				<input type="hidden" name="collection" value="<%= question.collection.id %>" />
				<input type="hidden" name="profile" value="_default" />
			</div>
		</form>
	</div>

    <% if (response && response.resultPacket) { %>
		
			<p id="fb-matching">
				<span id="fb-utils">
					<a href="#" id="fb-advanced-toggle">Advanced search</a>
					<span id="fb-help">| <a href="/search/help/simple_search.html">Help</a></span>
				</span>
		
                <% if (response.resultPacket.resultsSummary.totalMatching > 0) { %>
    				<span class="fb-result-count" id="fb-page-start"><%= response.resultPacket.resultsSummary.currStart %></span> -
	    			<span class="fb-result-count" id="fb-page-end"><%= response.resultPacket.resultsSummary.currEnd %></span> of
		    		<span class="fb-result-count" id="fb-total-matching"><%= response.resultPacket.resultsSummary.totalMatching %></span>
		    		search results
                <% } else { %>
			        <span class="fb-result-count" id="fb-total-matching">0</span> search results
                <% } %>

                for <strong><%= response.resultPacket.query %></strong>
                
                <% if (response.resultPacket.resultsSummary.partiallyMatching > 0) { %>
			        where
            		<span class="fb-result-count" id="fb-fully-matching">
			          	<%= response.resultPacket.resultsSummary.fullyMatching %>
			        </span>
			        match all words and
			        <span class="fb-result-count" id="fb-partially-matching">
			          	<%= response.resultPacket.resultsSummary.partiallyMatching %>
			        </span>
			        match some words.
                <% } %>
			</p>		
			
			<div id="fb-wrapper">
			
					<!-- RESULTS SUMMARY -->
					<div id="fb-summary">
	
                        <% if (response.resultPacket.spell) { %>
							<!-- Did you mean...? -->
							<span id="fb-spelling">
								Did you mean <a href="<%= response.resultPacket.spell.url %>"><%= response.resultPacket.spell.text %></a> ?
							</span>
                        <% } %>
		
						<!-- TIER BARS -->
					</div>
					
					<!-- FEATURED PAGES (BEST BETS) -->
					<% if (response.resultPacket.bestBets && response.resultPacket.bestBets.length > 0) { %>
                        <% for (var i=0; i<response.resultPacket.bestBets.length; i++) {
                            var bb = response.resultPacket.bestBets[i] %>
						    <div class="fb-best-bet">
							    <% if (bb.title) { %><h3><a href="<%= bb.link %>"><%= bb.title %></a></h3><% } %>
							    <% if (bb.description) { %><p><%= bb.description %></p><% } %>
							    <% if (bb.link) { %><p><cite><%= bb.link %></cite></p><% } %>
							    <% if (!bb.title) { %><p><strong><%= bb.trigger %>:</strong> <a href="<%= bb.link %>"><%= bb.link %></a><% } %>
						    </div>
                        <% } %>
                    <% } %>
	
					<!-- RESULTS -->
					<ol id="fb-results">
					
                        <%
                        if (response.resultPacket.results && response.resultPacket.results.length > 0) {
                            for (var i=0; i<response.resultPacket.results.length; i++) {
                                var result = response.resultPacket.results[i];
                                %>
                                <!-- EACH RESULT -->
                                <li class="result">
                                    <h3>
                                        <% if (result.fileType != 'html') { %>
                                            <span class="fb-filetype fb-<%= result.fileType %>">[<%= result.fileType.toUpperCase() %>]&nbsp;</span>
                                        <% } %>
                                        <a href="<%= result.displayUrl %>" title="<%= result.liveUrl %>"><%= result.title %></a>
                                    </h3>
                            
                                    <% if (result.fileType.search(/pdf|doc|xls|ppt|rtf/) > -1) { %>
                                        <p class="fb-file-format">
                                            <span>
                                                <%= result.fileSize %> - 
                                                <% switch (result.fileType.toLowerCase()) {
                                                    case 'pdf': %><%= 'PDF' %><% ; break;
                                                    case 'doc': %><%= 'Microsoft Word' %><% ; break;
                                                    case 'xls': %><%= 'Microsoft Excel' %><% ; break;
                                                    case 'ppt': %><%= 'Microsoft PowerPoint' %><% ; break;
                                                    case 'rtf': %><%= 'Rich Text Format' %><% ; break;
                                                } %>
                                            </span>
                                            <a class="fb-cached" href="<%= result.cacheUrl %>" title="View '<%= result.title %>' as HTML">View as HTML</a>
                                        </p>
                                    <% } %>
                                        
                                    <!-- QUERY BIASED SUMMARY (WITH DATE)-->
                                    <p>
                                        <span class="fb-date"><%= result.date %></span>
                                        <span class="fb-summary"><%= result.summary %></span>
                                    </p>
                            
                                    <!-- METADATA SUMMARIES -->
                                    <% if (result.metaData.c) { %><p><%= result.metaData.c %></p><% } %>
                                    <% if (result.metaData.a) { %><span class="fb-meta author"><span>by </span> <%= result.metaData.a %></span><% } %>
                                    <% if (result.metaData.s) { %><span class="fb-meta keywords"><span>Keywords:</span> <%= result.metaData.s %></span><% } %>
                                    <% if (result.metaData.p) { %><span class="fb-meta publisher"><span>Publisher:</span> <%= result.metaData.p %></span><% } %>
                            
                                    <!-- URL AND FILESIZE -->
                                    <p>
                                        <cite><%= (result.liveUrl.length > 70) ? result.liveUrl.substring(0, 70) + '...' : result.liveUrl %></cite>
                                        <% if (result.fileType.search(/pdf|doc|xls|ppt|rtf/) < 0) { %>
                                            - <a class="fb-cached" href="<%= result.cacheUrl %>" title="Cached version of <%= result.title %>">Cached</a>
                                        <% } %>
                                            
                                        <!-- EXPLORE LINKS -->
                                        <a class="fb-explore" href="?<%= question.queryString.replace(/query=[^&]*/, 'query=explore:' + result.liveUrl) %>">Explore</a>
                                    </p>
                           
                            
                                    <!-- QUICKLINKS -->
                                </li>
                            <% } %>

                        <% } else { %>
                            <!-- NO RESULTS -->
                            <li id="fb-no-results">Your search for <strong></strong> did not return any results. <span>Please ensure that you:</span>
                                <ul>
                                    <li>are not using any advanced search operators like + - | " etc.</li> 
                                    <li>expect this document to exist within the collection <em><%= question.collection.id %></em></li>
                                    <li>have permission to see any documents that may match your query</li>
                                </ul>
                            </li>
                        <% } %>
						
					    <p class="fb-page-nav">
                            <% if (response.resultPacket.resultsSummary.prevStart > 0) { %>
                                <% if (question.queryString.search(/start_rank=/) > -1) { %>
    						    	[ <a href="?<%= question.queryString.replace(/start_rank=[^&]*/, 'start_rank=' + response.resultPacket.resultsSummary.prevStart) %>" class="fb-previous-result-page fb-page-nav">Prev <%= response.resultPacket.resultsSummary.numRanks %></a> ]
                                <% } else { %>
    						    	[ <a href="?<%= question.queryString %>&amp;start_rank=<%= response.resultPacket.resultsSummary.prevStart %>" class="fb-previous-result-page fb-page-nav">Prev <%= response.resultPacket.resultsSummary.numRanks %></a> ]
                                <% } %>
                            <% } %>

                            <%
                            var pages = (response.resultPacket.resultsSummary.totalMatching + response.resultPacket.resultsSummary.numRanks - 1) / response.resultPacket.resultsSummary.numRanks;
                            var currPage = (response.resultPacket.resultsSummary.currStart + response.resultPacket.resultsSummary.numRanks - 1) / response.resultPacket.resultsSummary.numRanks;
                            var firstPage = 1;
                            if (currPage > 4) {
                                firstPage = currPage - 4;
                            }

                            for (var pg = firstPage; pg < firstPage+10 && pg < pages ; pg++) {
                                %>&nbsp;<%
                                if (pg == currPage) { 
                                    %><span class="fb-current-result-page"><%= currPage %></span><%
                                } else {
                                    if (question.queryString.search(/start_rank=/) > -1) {
                                        %><a href="?<%= question.queryString.replace(/start_rank=[^&]*/, 'start_rank=' + (pg-1)*response.resultPacket.resultsSummary.numRanks) %>"><%= pg %></a><%
                                    } else {
                                        %><a href="?<%= question.queryString %>&amp;start_rank=<%= (pg-1)*response.resultPacket.resultsSummary.numRanks %>"><%= pg %></a><%
                                    }
                                }
                                %>&nbsp;<%
                            }
                            %>

                            <% if (response.resultPacket.resultsSummary.nextStart > 0) { %>
                                <% if (question.queryString.search(/start_rank=/) > -1) { %>
    						    	[ <a href="?<%= question.queryString.replace(/start_rank=[^&]*/, 'start_rank=' + response.resultPacket.resultsSummary.nextStart) %>" class="fb-previous-result-page fb-page-nav">Next <%= response.resultPacket.resultsSummary.numRanks %></a> ]
                                <% } else { %>
    						    	[ <a href="?<%= question.queryString %>&amp;start_rank=<%= response.resultPacket.resultsSummary.nextStart %>" class="fb-previous-result-page fb-page-nav">Next <%= response.resultPacket.resultsSummary.numRanks %></a> ]
                                <% } %>
                            <% } %>

						</p>
					
					</ol> 
			</div>
        <% } %>
</body>
</html>
