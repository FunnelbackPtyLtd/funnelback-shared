<?xml version="1.0" encoding="UTF-8"?>

<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-2.0.xsd">

    <!-- Make sure you use only lowercase names otherwise the tables names will be quoted by
         liquibase and badness will ensue -->

    <!-- logicalFilePath required so that path will be independent from where you
         run liquibase (Maven, command line...) to avoid liquibase detecting a difference
         in the changesets that were run -->
    <changeSet id="1" author="nguillaumin" logicalFilePath="session-db-changelog-1.0.xml">
        <createTable tableName="searchhistory">
            <column name="userid" type="varchar(64)">
                <constraints nullable="false" />
            </column>
            <column name="collection" type="varchar(255)">
                <constraints nullable="false" />
            </column>
            <column name="searchdate" type="timestamp">
                <constraints nullable="false" />
            </column>
            <column name="originalquery" type="varchar(255)">
                <constraints nullable="false" />
            </column>
            <column name="queryasprocessed" type="varchar(255)">
                <constraints nullable="false" />
            </column>
            <column name="totalmatching" type="int">
                <constraints nullable="false" />
            </column>
            <column name="currstart" type="int">
                <constraints nullable="false" />
            </column>
            <column name="numranks" type="int">
                <constraints nullable="false" />
            </column>
            <column name="searchparams" type="varchar(1024)">
                <constraints nullable="false" />
            </column>
            <column name="searchparamssignature" type="int">
                <constraints nullable="false" />
            </column>
        </createTable>
        <addPrimaryKey tableName="searchhistory" columnNames="userid,collection,searchparamssignature"/>
        <createIndex tableName="searchhistory" indexName="searchhistory_userid_idx">
            <column name="userid" />
        </createIndex>
        <createIndex tableName="searchhistory" indexName="searchhistory_collection_idx">
            <column name="collection" />
        </createIndex>
        <createIndex tableName="searchhistory" indexName="searchhistory_searchparamssignature_idx">
            <column name="searchparamssignature" />
        </createIndex>

        <createTable tableName="clickhistory">
            <column name="userid" type="varchar(64)">
                <constraints nullable="false" />
            </column>
            <column name="collection" type="varchar(255)">
                <constraints nullable="false" />
            </column>
            <column name="indexurl" type="varchar(1024)">
                <constraints nullable="false" />
            </column>
            <column name="clickdate" type="timestamp">
                <constraints nullable="false" />
            </column>
            <column name="query" type="varchar(255)">
                <constraints nullable="false" />
            </column>
            <column name="title" type="varchar(255)">
                <constraints nullable="false" />
            </column>
            <column name="summary" type="varchar(1024)" />
        </createTable>
        <addPrimaryKey tableName="clickhistory" columnNames="userid,collection,indexurl"/>
        <createIndex tableName="clickhistory" indexName="clickhistory_userid_idx">
            <column name="userid" />
        </createIndex>
        <createIndex tableName="clickhistory" indexName="clickhistory_collection_idx">
            <column name="collection" />
        </createIndex>
        <createIndex tableName="clickhistory" indexName="clickhistory_indexurl_idx">
            <column name="indexurl" />
        </createIndex>

        <createTable tableName="clickhistorymetadata">
            <column name="userid" type="varchar(64)">
                <constraints nullable="false" />
            </column>
            <column name="collection" type="varchar(255)">
                <constraints nullable="false" />
            </column>
            <column name="indexurl" type="varchar(1024)">
                <constraints nullable="false" />
            </column>
            <column name="key" type="char(1)">
                <constraints nullable="false" />
            </column>
            <column name="metadata" type="varchar(4096)">
                <constraints nullable="false" />
            </column>
        </createTable>
        <addPrimaryKey tableName="clickhistorymetadata" columnNames="userid,collection,indexurl,key"/>

        <createTable tableName="cartresult">
            <column name="userid" type="varchar(64)">
                <constraints nullable="false" />
            </column>
            <column name="collection" type="varchar(255)">
                <constraints nullable="false" />
            </column>
            <column name="indexurl" type="varchar(1024)">
                <constraints nullable="false" />
            </column>
            <column name="addeddate" type="timestamp">
                <constraints nullable="false" />
            </column>
            <column name="title" type="varchar(255)">
                <constraints nullable="false" />
            </column>
            <column name="summary" type="varchar(1024)" />
        </createTable>
        <addPrimaryKey tableName="cartresult" columnNames="userid,collection,indexurl"/>
        <createIndex tableName="cartresult" indexName="cartresult_userid_idx">
            <column name="userid" />
        </createIndex>
        <createIndex tableName="cartresult" indexName="cartresult_collection_idx">
            <column name="collection" />
        </createIndex>
        <createIndex tableName="cartresult" indexName="cartresult_indexurl_idx">
            <column name="indexurl" />
        </createIndex>

        <createTable tableName="cartresultmetadata">
            <column name="userid" type="varchar(64)">
                <constraints nullable="false" />
            </column>
            <column name="collection" type="varchar(255)">
                <constraints nullable="false" />
            </column>
            <column name="indexurl" type="varchar(1024)">
                <constraints nullable="false" />
            </column>
            <column name="key" type="char(1)">
                <constraints nullable="false" />
            </column>
            <column name="metadata" type="varchar(4096)">
                <constraints nullable="false" />
            </column>
        </createTable>
        <addPrimaryKey tableName="cartresultmetadata" columnNames="userid,collection,indexurl,key"/>

    </changeSet>

</databaseChangeLog>